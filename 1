[DEBUG] Initializing USB manager...
[DEBUG] libusb initialized successfully
[DEBUG] Processing 7 devices
[DEBUG] Device 0: VID=0x1D6B, PID=0x0003
[DEBUG] Device 1: VID=0xA108, PID=0xC309
[DEBUG] Found Ingenic device 1 (VID:0xA108, PID:0xC309)
[DEBUG] Device 2: VID=0x30C9, PID=0x002B
[DEBUG] Device 3: VID=0x8087, PID=0x0026
[DEBUG] Device 4: VID=0x1D6B, PID=0x0002
[DEBUG] Device 5: VID=0x1D6B, PID=0x0003
[DEBUG] Device 6: VID=0x1D6B, PID=0x0002
[DEBUG] Found 1 Ingenic devices
[DEBUG] Allocating memory for 1 devices
[DEBUG] Memory allocated successfully
[DEBUG] Checking CPU info for device 0 to determine actual stage
[DEBUG] Allocating device structure...
[DEBUG] Setting device info and context...
[DEBUG] Manager device variant: 5 (t31x)
[DEBUG] Initializing device (bus=3, addr=25)...
[DEBUG] usb_device_init: preserving variant 5, context=0x559b83d452b0
[DEBUG] Device initialized: VID:0xA108, PID:0xC309, Bus:3, Addr:25
[DEBUG] Device initialized successfully
[DEBUG] GetCPUInfo: Starting CPU info request (VID:0xA108, PID:0xC309)
[DEBUG] GetCPUInfo: Sending vendor request VR_GET_CPU_INFO (0x00)
[DEBUG] GetCPUInfo: Direct control transfer succeeded: 8 bytes
[DEBUG] GetCPUInfo: Got 8 bytes of response data
[DEBUG] GetCPUInfo: CPU magic bytes: [DEBUG] 0x54 [DEBUG] 0x20 [DEBUG] 0x32 [DEBUG] 0x20 [DEBUG] 0x30 [DEBUG] 0x20 [DEBUG] 0x56 [DEBUG] 0x20 [DEBUG] -> string = 'T20V' -> clean = 'T 2 0 V '
[DEBUG] GetCPUInfo: Device is in bootrom stage
[DEBUG] Device 0 is in bootrom stage (CPU magic: T 2 0 V )
[DEBUG] detect_variant_from_magic: input='T 2 0 V ' (length=8)
[DEBUG] detect_variant_from_magic: checking pattern match
[DEBUG] Updated device 0 variant to t20 (0) based on CPU magic
Writing firmware to device [0]: t20 bootrom (Bus 003 Address 025)
[DEBUG] Allocating device structure...
[DEBUG] Setting device info and context...
[DEBUG] Manager device variant: 0 (t20)
[DEBUG] Initializing device (bus=3, addr=25)...
[DEBUG] usb_device_init: preserving variant 0, context=0x559b83d452b0
[DEBUG] Device initialized: VID:0xA108, PID:0xC309, Bus:3, Addr:25
[DEBUG] Device initialized successfully

Device not in firmware stage, attempting bootstrap first...
Starting bootstrap sequence for t20
[DEBUG] Skipping device reset (vendor tool doesn't reset)
[DEBUG] Setting USB configuration to 1 (required for endpoint 0x02 creation)
[DEBUG] SET_CONFIGURATION(1) successful
[DEBUG] Getting CPU info...
[DEBUG] GetCPUInfo: Starting CPU info request (VID:0xA108, PID:0xC309)
[DEBUG] GetCPUInfo: Sending vendor request VR_GET_CPU_INFO (0x00)
[DEBUG] GetCPUInfo: Direct control transfer succeeded: 8 bytes
[DEBUG] GetCPUInfo: Got 8 bytes of response data
[DEBUG] GetCPUInfo: CPU magic bytes: [DEBUG] 0x54 [DEBUG] 0x20 [DEBUG] 0x32 [DEBUG] 0x20 [DEBUG] 0x30 [DEBUG] 0x20 [DEBUG] 0x56 [DEBUG] 0x20 [DEBUG] -> string = 'T20V' -> clean = 'T 2 0 V '
[DEBUG] GetCPUInfo: Device is in bootrom stage
CPU magic (raw hex): 54 20 32 20 30 20 56 20 
CPU info: stage=bootrom, magic='T 2 0 V '
[DEBUG] detect_variant_from_magic: input='T 2 0 V ' (length=8)
[DEBUG] detect_variant_from_magic: checking pattern match
Detected processor variant: t20 (from magic: 'T 2 0 V ')
[DEBUG] Loading firmware files...
[DEBUG] Using default firmware files
[DEBUG] firmware_load: variant=0 (t20)
[DEBUG] firmware_load: matched VARIANT_T20 (0)
[DEBUG] firmware_load: calling firmware_load_t20
[DEBUG] Loading T20 firmware...
[DEBUG] Attempting to generate DDR configuration dynamically
[DEBUG] firmware_generate_ddr_config: variant=0 (t20)
[DEBUG] Using vendor reference DDR binary for T20 (different format than T31X)
[DEBUG] Using T20 reference DDR binary: 396 bytes
✓ DDR configuration generated dynamically: 396 bytes
[DEBUG] Loading embedded T20 firmware from database
[DEBUG] Loaded embedded T20 SPL: 10176 bytes
[DEBUG] Loaded embedded T20 U-Boot: 390480 bytes
[DEBUG] T20 firmware loaded successfully (embedded firmware)
[DEBUG] DDR config: 396 bytes, SPL: 10176 bytes, U-Boot: 390480 bytes
Firmware loaded - Config: 396 bytes, SPL: 10176 bytes, U-Boot: 390480 bytes
Loading DDR configuration
[DEBUG] Setting data address to 0x80001000
[DEBUG] SetDataAddress: 0x80001000
[DEBUG] SetDataAddress OK
[DEBUG] Setting data length to 396 bytes
[DEBUG] SetDataLength: 396 (0x0000018c)
[DEBUG] SetDataLength OK
[DEBUG] Transferring data (396 bytes)...
[DEBUG] TransferData starting: 396 bytes total
[DEBUG] TransferData chunk: offset=0, size=396, remaining=396
[DEBUG] Bulk transfer: write 396 bytes, timeout=5000ms, endpoint=0x01
[DEBUG] Bulk transfer success: 396 bytes transferred
[DEBUG] TransferData chunk written: 396 bytes (attempt 1)
[DEBUG] TransferData complete: 396 bytes written successfully
DDR configuration loaded
Loading SPL (Stage 1 bootloader)
[DEBUG] Setting data address to 0x80001800
[DEBUG] SetDataAddress: 0x80001800
[DEBUG] SetDataAddress OK
[DEBUG] Setting data length to 10176 bytes
[DEBUG] SetDataLength: 10176 (0x000027c0)
[DEBUG] SetDataLength OK
[DEBUG] Transferring data (10176 bytes)...
[DEBUG] TransferData starting: 10176 bytes total
[DEBUG] TransferData chunk: offset=0, size=10176, remaining=10176
[DEBUG] Bulk transfer: write 10176 bytes, timeout=5000ms, endpoint=0x01
[DEBUG] Bulk transfer success: 10176 bytes transferred
[DEBUG] TransferData chunk written: 10176 bytes (attempt 1)
[DEBUG] TransferData complete: 10176 bytes written successfully
SPL loaded
[DEBUG] Setting execution size (d2i_len) to 0x4000 for t20
[DEBUG] SetDataLength: 16384 (0x00004000)
[DEBUG] SetDataLength OK
[DEBUG] Executing SPL from entry point 0x80001800
[DEBUG] ProgStage1: addr=0x80001800
[DEBUG] ProgStage1 OK
SPL execution started
[DEBUG] Waiting for SPL to complete DDR initialization (keeping device handle open)...
[DEBUG] SPL should have completed, device handle remains valid
Loading U-Boot (Stage 2 bootloader)
[DEBUG] Setting U-Boot data address to 0x80100000
[DEBUG] SetDataAddress: 0x80100000
[DEBUG] SetDataAddress OK
[DEBUG] Setting U-Boot data length to 390480 bytes
[DEBUG] SetDataLength: 390480 (0x0005f550)
[DEBUG] SetDataLength OK
[DEBUG] Transferring U-Boot data (390480 bytes)...
[DEBUG] TransferData starting: 390480 bytes total
[DEBUG] TransferData chunk: offset=0, size=390480, remaining=390480
[DEBUG] Bulk transfer: write 390480 bytes, timeout=10000ms, endpoint=0x01
[DEBUG] Bulk transfer success: 390480 bytes transferred
[DEBUG] TransferData chunk written: 390480 bytes (attempt 1)
[DEBUG] TransferData complete: 390480 bytes written successfully
[DEBUG] Waiting for device to process U-Boot transfer...
[DEBUG] Flushing cache before U-Boot execution
[DEBUG] FlushCache: executing
[DEBUG] FlushCache OK
[DEBUG] Executing U-Boot using ProgStage2
[DEBUG] ProgStage2: wValue=0x8010 (MSB), wIndex=0x0000 (LSB), addr=0x80100000
[DEBUG] ProgStage2: addr=0x80100000
[DEBUG] ProgStage2 OK
[DEBUG] ProgStage2 completed - device should now be in firmware stage
U-Boot loaded
[DEBUG] Checking CPU info immediately after PROG_START2 (vendor sequence)...
[DEBUG] GetCPUInfo: Starting CPU info request (VID:0xA108, PID:0xC309)
[DEBUG] GetCPUInfo: Sending vendor request VR_GET_CPU_INFO (0x00)
[DEBUG] GetCPUInfo: Direct control transfer succeeded: 8 bytes
[DEBUG] GetCPUInfo: Got 8 bytes of response data
[DEBUG] GetCPUInfo: CPU magic bytes: [DEBUG] 0x42 [DEBUG] 0x4F [DEBUG] 0x4F [DEBUG] 0x54 [DEBUG] 0x78 [DEBUG] 0x31 [DEBUG] 0x35 [DEBUG] 0x32 [DEBUG] -> string = 'BOOTx152' -> clean = 'BOOTx152'
[DEBUG] GetCPUInfo: Device is in firmware stage
[DEBUG] CPU info after PROG_START2: stage=firmware, magic='BOOTx152'
Bootstrap sequence completed successfully
Bootstrap completed successfully!
Device remains open with configuration preserved

Writing firmware from file: /home/squash/Downloads/thingino-wyze_cam2_t20x_jxf23_rtl8189ftv.bin
Reading firmware from file: /home/squash/Downloads/thingino-wyze_cam2_t20x_jxf23_rtl8189ftv.bin
Firmware file size: 16777216 bytes (16.00 MB)
Writing firmware to device (16777216 bytes)...
[DEBUG] firmware_write_full: Sending flash descriptor...
[DEBUG] Sending flash descriptor (972 bytes)...
[DEBUG] Step 1: Sending control transfer (bRequest=0x14, 40 bytes)...
[DEBUG] Control transfer successful
[DEBUG] Step 2: Sending bulk OUT transfer (972 bytes to endpoint 0x01)...
[DEBUG] Bulk transfer successful: 972 bytes
[DEBUG] Flash descriptor sent successfully
[DEBUG] Flash descriptor sent successfully
[DEBUG] Checking available USB endpoints...
[DEBUG] Active configuration has 1 interfaces
[DEBUG]   Interface 0 has 1 altsettings
[DEBUG]     Altsetting 0 has 2 endpoints
[DEBUG]       Endpoint 0x01: OUT, max packet size 512
[DEBUG]       Endpoint 0x81: IN, max packet size 512
[DEBUG] Interface 0 claimed successfully
Initiating flash erase...
[DEBUG] Sending VR_FW_HANDSHAKE to initiate flash erase
[DEBUG] Initial status: 00 00 00 00
[DEBUG] Flash erase command sent
[DEBUG] Status after erase command: 00 00 00 00
[DEBUG] Waiting 1 second for device to be ready for erase data...
Sending flash erase sequence (369 packets of 902 bytes each)...
[DEBUG] Bulk transfer: write 902 bytes, timeout=5000ms, endpoint=0x02
[ERROR] Bulk transfer failed: LIBUSB_ERROR_IO (endpoint=0x02, length=902, timeout=5000ms)
Failed to send erase packet 1/369: Transfer failed

✗ Firmware write failed: Transfer failed
